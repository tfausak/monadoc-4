version: v1.0
name: Build pipeline

agent:
  machine:
    type: e1-standard-2
  containers:
    - name: main
      image: semaphoreci/haskell:8.6.5

blocks:
  - name: Build block
    task:
      env_vars:
        - { name: STACK_ROOT, value: /root/monadoc/.stack/root }
        - { name: STACK_WORK, value: .stack/work }
      jobs:
        - name: Build job
          commands_file: build.sh

promotions:
  - name: Deploy promotion
    pipeline_file: deploy.yml
    auto_promote:
      when: result = 'passed' and branch = 'monadoc'
